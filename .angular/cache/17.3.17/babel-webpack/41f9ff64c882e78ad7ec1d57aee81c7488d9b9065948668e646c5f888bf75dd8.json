{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nimport { Component, ElementRef, Inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MOCK_STUDENTS, MOCK_TEACHERS } from '../constants';\nlet TeacherAssignmentComponent = class TeacherAssignmentComponent {\n  constructor(elementRef) {\n    this.elementRef = elementRef;\n    // Use MOCK_STUDENTS direct reference to ensure synchronization across modules\n    this.students = MOCK_STUDENTS;\n    this.teachers = MOCK_TEACHERS;\n    this.filteredStudents = [];\n    this.filteredTeachers = [];\n    // ... rest of the code remains same, logic for references is updated by removing JSON.parse/stringify ...\n    this.selectedStudentIds = new Set();\n    this.selectedTeacherIds = new Set();\n    // Filter States\n    this.studentSearchTerm = '';\n    this.blockFilter = ''; // Khối: 'Mầm' | 'Chồi' | 'Lá' | '6-18' | '19-24' | '25-36' | ''\n    this.classFilter = ''; // Lớp cụ thể: 'Mầm 1', 'Mầm 2', 'Chồi 1', ...\n    this.teacherSearchTerm = '';\n    // New state for unassigned filter\n    this.showUnassignedOnly = false;\n    // If true, applied teacher(s) will set homeroom for selected students\n    this.assignAsHomeroom = false;\n    // Modal State\n    this.viewingStudentDetails = null;\n    this.viewingTeachers = [];\n    // Toast Notification State\n    this.showToast = false;\n    this.toastMessage = '';\n    this.toastType = 'success';\n    this.applyStudentFilters();\n    this.filteredTeachers = [...this.teachers];\n  }\n  // Helper to show notification\n  showNotification(message, type = 'success') {\n    this.toastMessage = message;\n    this.toastType = type;\n    this.showToast = true;\n    setTimeout(() => {\n      this.showToast = false;\n    }, 3000);\n  }\n  // Helper to count total unassigned students\n  get unassignedCount() {\n    return this.students.filter(s => !s.assignedTeacherIds || s.assignedTeacherIds.length === 0).length;\n  }\n  toggleUnassignedFilter() {\n    this.showUnassignedOnly = !this.showUnassignedOnly;\n    this.applyStudentFilters();\n  }\n  // --- Student Filters ---\n  onStudentSearch(event) {\n    this.studentSearchTerm = event.target.value.toLowerCase();\n    this.applyStudentFilters();\n  }\n  onBlockFilterChange(event) {\n    this.blockFilter = event.target.value;\n    this.classFilter = ''; // Reset class filter when block changes\n    this.applyStudentFilters();\n  }\n  onClassFilterChange(event) {\n    this.classFilter = event.target.value;\n    // Auto-update blockFilter based on selected class\n    if (this.classFilter) {\n      if (this.classFilter.includes('Mầm')) {\n        this.blockFilter = 'Mầm';\n      } else if (this.classFilter.includes('Chồi')) {\n        this.blockFilter = 'Chồi';\n      } else if (this.classFilter.includes('Lá')) {\n        this.blockFilter = 'Lá';\n      } else if (this.classFilter.includes('6-18')) {\n        this.blockFilter = '6-18';\n      } else if (this.classFilter.includes('19-24')) {\n        this.blockFilter = '19-24';\n      } else if (this.classFilter.includes('25-36')) {\n        this.blockFilter = '25-36';\n      }\n    }\n    this.applyStudentFilters();\n  }\n  // Get available classes based on current block filter\n  getAvailableClasses() {\n    const allClasses = [...new Set(this.students.map(s => s.className))].sort();\n    if (!this.blockFilter) return allClasses;\n    // Filter by block prefix (e.g., 'Mầm' includes 'Mầm 1', 'Mầm 2')\n    return allClasses.filter(c => c.startsWith(this.blockFilter));\n  }\n  // Get grouped classes for template\n  getGroupedClasses() {\n    const allClasses = [...new Set(this.students.map(s => s.className))].sort();\n    // If blockFilter is set, only show classes in that block\n    let filteredClasses = allClasses;\n    if (this.blockFilter) {\n      filteredClasses = allClasses.filter(c => c.startsWith(this.blockFilter));\n    }\n    const mauGiao = filteredClasses.filter(c => c.includes('Mầm') || c.includes('Chồi') || c.includes('Lá'));\n    const nhaTre = filteredClasses.filter(c => c.includes('6-18') || c.includes('19-24') || c.includes('25-36'));\n    const groups = [];\n    if (mauGiao.length > 0) {\n      groups.push({\n        label: 'Mẫu Giáo',\n        classes: mauGiao\n      });\n    }\n    if (nhaTre.length > 0) {\n      groups.push({\n        label: 'Nhà Trẻ',\n        classes: nhaTre\n      });\n    }\n    return groups;\n  }\n  getClassPriority(className) {\n    if (className.includes('Mầm')) return 1;\n    if (className.includes('Chồi')) return 2;\n    if (className.includes('Lá')) return 3;\n    if (className.includes('6-18')) return 4;\n    if (className.includes('19-24')) return 5;\n    if (className.includes('25-36')) return 6;\n    return 99; // Các lớp khác (nếu có)\n  }\n  applyStudentFilters() {\n    // 1. Filter\n    let result = this.students.filter(s => {\n      const matchesSearch = s.fullName.toLowerCase().includes(this.studentSearchTerm) || s.code.toLowerCase().includes(this.studentSearchTerm);\n      // Filter by block first (e.g., 'Mầm' matches 'Mầm 1', 'Mầm 2')\n      let matchesBlock = true;\n      if (this.blockFilter) {\n        matchesBlock = s.className.startsWith(this.blockFilter);\n      }\n      // Then filter by specific class (exact match)\n      const matchesClass = this.classFilter ? s.className === this.classFilter : true;\n      const isUnassigned = !s.assignedTeacherIds || s.assignedTeacherIds.length === 0;\n      const matchesUnassigned = this.showUnassignedOnly ? isUnassigned : true;\n      return matchesSearch && matchesBlock && matchesClass && matchesUnassigned;\n    });\n    // 2. Sort: Mầm -> Chồi -> Lá -> 6-18 -> 19-24 -> 25-36\n    result.sort((a, b) => {\n      const priorityA = this.getClassPriority(a.className);\n      const priorityB = this.getClassPriority(b.className);\n      if (priorityA !== priorityB) {\n        return priorityA - priorityB;\n      }\n      return a.className.localeCompare(b.className);\n    });\n    this.filteredStudents = result;\n  }\n  // --- Teacher Search ---\n  onTeacherSearch(event) {\n    this.teacherSearchTerm = event.target.value.toLowerCase();\n    this.filteredTeachers = this.teachers.filter(t => t.name.toLowerCase().includes(this.teacherSearchTerm) || t.shortName.toLowerCase().includes(this.teacherSearchTerm) || t.cccd.includes(this.teacherSearchTerm));\n  }\n  // --- Student Selection Logic ---\n  toggleStudent(id) {\n    if (this.selectedStudentIds.has(id)) {\n      this.selectedStudentIds.delete(id);\n    } else {\n      this.selectedStudentIds.add(id);\n    }\n  }\n  toggleSelectAll() {\n    if (this.isAllSelected()) {\n      this.selectedStudentIds.clear();\n    } else {\n      this.filteredStudents.forEach(s => this.selectedStudentIds.add(s.id));\n    }\n  }\n  isAllSelected() {\n    return this.filteredStudents.length > 0 && this.selectedStudentIds.size === this.filteredStudents.length;\n  }\n  // --- Teacher Selection Logic ---\n  toggleTeacherSelection(teacherId) {\n    if (this.selectedTeacherIds.has(teacherId)) {\n      this.selectedTeacherIds.delete(teacherId);\n    } else {\n      this.selectedTeacherIds.add(teacherId);\n    }\n  }\n  isTeacherSelected(teacherId) {\n    return this.selectedTeacherIds.has(teacherId);\n  }\n  // --- Main Actions ---\n  applyAssignment() {\n    if (this.selectedStudentIds.size === 0 || this.selectedTeacherIds.size === 0) return;\n    const teachersToAdd = Array.from(this.selectedTeacherIds);\n    // If assigning as homeroom, ensure only one teacher is selected\n    if (this.assignAsHomeroom && teachersToAdd.length > 1) {\n      this.showNotification('Chỉ có thể chọn 1 giáo viên làm chủ nhiệm. Vui lòng chọn 1 giáo viên.', 'warning');\n      // Uncheck the homeroom toggle immediately\n      this.assignAsHomeroom = false;\n      return;\n    }\n    let countSuccess = 0;\n    let hasError = false;\n    this.students.forEach(student => {\n      if (this.selectedStudentIds.has(student.id)) {\n        if (!student.assignedTeacherIds) student.assignedTeacherIds = [];\n        let added = false;\n        for (const newId of teachersToAdd) {\n          // If not assigning as homeroom and the teacher is already the student's homeroom, warn and skip\n          if (!this.assignAsHomeroom && student.homeroomTeacherId && newId === student.homeroomTeacherId) {\n            const teacher = this.teachers.find(t => t.id === newId);\n            if (teacher) {\n              this.showNotification(`Giáo viên ${teacher.shortName} đã được phân làm giáo viên chủ nhiệm cho học sinh ${student.fullName}.`, 'warning');\n            }\n            continue;\n          }\n          if (!student.assignedTeacherIds.includes(newId)) {\n            student.assignedTeacherIds.push(newId);\n            added = true;\n          }\n        }\n        // If assigning as homeroom, set homeroomTeacherId to the first selected teacher\n        if (this.assignAsHomeroom && teachersToAdd.length > 0) {\n          const homeroomTeacherId = teachersToAdd[0];\n          const homeroomTeacher = this.teachers.find(t => t.id === homeroomTeacherId);\n          // Check if this teacher is already homeroom of another class\n          const existingClass = this.getHomeroomClassForTeacher(homeroomTeacherId);\n          if (existingClass && existingClass !== student.className) {\n            const teacherName = homeroomTeacher?.shortName || 'Giáo viên';\n            this.showNotification(`${teacherName} đã là giáo viên chủ nhiệm của lớp ${existingClass}. Một giáo viên chỉ có thể chủ nhiệm 1 lớp.`, 'error');\n            hasError = true;\n            // Reset homeroom toggle when error occurs\n            this.assignAsHomeroom = false;\n            return; // Stop assignment for this student\n          }\n          // pick first selected teacher as homeroom\n          student.homeroomTeacherId = homeroomTeacherId;\n          // ensure homeroom teacher is included in assignedTeacherIds\n          if (!student.assignedTeacherIds.includes(homeroomTeacherId)) {\n            student.assignedTeacherIds.push(homeroomTeacherId);\n            added = true;\n          }\n        }\n        if (added) countSuccess++;\n      }\n    });\n    this.applyStudentFilters(); // Refresh UI\n    this.selectedTeacherIds.clear(); // Reset Teacher checkboxes\n    this.selectedStudentIds.clear(); // Reset Student checkboxes\n    // Reset the homeroom assignment toggle after applying\n    this.assignAsHomeroom = false;\n    // Only show success message if there was no error and assignments were made\n    if (!hasError && countSuccess > 0) {\n      this.showNotification(`Đã phân công thành công cho ${countSuccess} học sinh!`, 'success');\n    }\n  }\n  removeAssignment() {\n    if (this.selectedStudentIds.size === 0 || this.selectedTeacherIds.size === 0) return;\n    const teachersToRemove = Array.from(this.selectedTeacherIds);\n    let changeCount = 0;\n    this.students.forEach(student => {\n      if (this.selectedStudentIds.has(student.id) && student.assignedTeacherIds) {\n        const originalLength = student.assignedTeacherIds.length;\n        student.assignedTeacherIds = student.assignedTeacherIds.filter(existingId => !teachersToRemove.includes(existingId));\n        // If homeroom teacher removed, clear homeroomTeacherId\n        if (student.homeroomTeacherId && teachersToRemove.includes(student.homeroomTeacherId)) {\n          student.homeroomTeacherId = undefined;\n        }\n        if (student.assignedTeacherIds.length !== originalLength) {\n          changeCount++;\n        }\n      }\n    });\n    if (changeCount === 0) {\n      this.showNotification('Các học sinh đã chọn chưa được phân công bởi giáo viên này.', 'warning');\n      return;\n    }\n    this.applyStudentFilters(); // Refresh UI\n    this.selectedTeacherIds.clear(); // Reset Teacher checkboxes\n    this.selectedStudentIds.clear(); // Reset Student checkboxes\n    this.showNotification(`Đã gỡ phân công thành công cho ${changeCount} học sinh.`, 'success');\n  }\n  // --- Helpers ---\n  getAssignedTeachers(student) {\n    if (!student.assignedTeacherIds) return [];\n    return this.teachers.filter(t => student.assignedTeacherIds.includes(t.id));\n  }\n  // Check if a teacher is already homeroom of another class\n  getHomeroomClassForTeacher(teacherId) {\n    const student = this.students.find(s => s.homeroomTeacherId === teacherId);\n    return student ? student.className : null;\n  }\n  // Toggle handler for homeroom checkbox — validate selection\n  onHomeroomToggle(checked, checkboxElement) {\n    if (checked && this.selectedTeacherIds.size > 1) {\n      this.showNotification('Chỉ có thể chọn 1 giáo viên làm chủ nhiệm. Vui lòng chọn 1 giáo viên.', 'warning');\n      this.assignAsHomeroom = false;\n      // Force uncheck the checkbox immediately\n      if (checkboxElement) {\n        checkboxElement.checked = false;\n      }\n      return;\n    }\n    this.assignAsHomeroom = checked;\n  }\n  // --- Details Modal Logic ---\n  openTeacherDetails(student) {\n    const assigned = this.getAssignedTeachers(student);\n    if (assigned.length === 0) return;\n    this.viewingStudentDetails = student;\n    this.viewingTeachers = assigned;\n  }\n  closeTeacherDetails() {\n    this.viewingStudentDetails = null;\n    this.viewingTeachers = [];\n  }\n};\nTeacherAssignmentComponent = __decorate([Component({\n  selector: 'app-teacher-assignment',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  template: `\n    <div class=\"flex flex-col lg:flex-row gap-6 h-[calc(100vh-140px)] relative\">\n      \n      <!-- TOAST NOTIFICATION -->\n      <div *ngIf=\"showToast\" \n           class=\"absolute top-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg border animate-in fade-in slide-in-from-top-4 duration-300\"\n           [ngClass]=\"{\n             'bg-green-50 border-green-200 text-green-800': toastType === 'success',\n             'bg-yellow-50 border-yellow-200 text-yellow-800': toastType === 'warning',\n             'bg-red-50 border-red-200 text-red-800': toastType === 'error'\n           }\">\n         <div [ngClass]=\"{\n             'text-green-500': toastType === 'success',\n             'text-yellow-500': toastType === 'warning',\n             'text-red-500': toastType === 'error'\n         }\">\n            <svg *ngIf=\"toastType === 'success'\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/><polyline points=\"22 4 12 14.01 9 11.01\"/></svg>\n            <svg *ngIf=\"toastType === 'warning'\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\"/><line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/><line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/></svg>\n            <svg *ngIf=\"toastType === 'error'\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"/><line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"/></svg>\n         </div>\n         <div class=\"text-sm font-medium\">{{ toastMessage }}</div>\n         <button (click)=\"showToast = false\" class=\"ml-2 hover:opacity-70\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>\n         </button>\n      </div>\n\n      <!-- LEFT COLUMN: STUDENT LIST (Main Work Area) -->\n      <div class=\"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 flex flex-col overflow-hidden\">\n        \n        <!-- Header & Search -->\n        <div class=\"p-4 border-b border-gray-200 bg-gray-50 flex flex-col gap-3\">\n          <div class=\"flex items-center justify-between\">\n             <h3 class=\"font-semibold text-gray-800\">Danh sách học sinh</h3>\n             \n             <div class=\"flex items-center gap-3\">\n                <!-- Total Students Badge -->\n                <div class=\"flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/><path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/></svg>\n                    Tổng số HS: <b>{{ students.length }}</b> em\n                </div>\n\n                <div class=\"h-4 w-px bg-gray-300\"></div>\n\n                <!-- Unassigned Filter Toggle -->\n                <button \n                  (click)=\"toggleUnassignedFilter()\"\n                  class=\"flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium border transition-colors shadow-sm\"\n                  [ngClass]=\"{\n                    'bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100': showUnassignedOnly,\n                    'bg-white text-gray-600 border-gray-300 hover:bg-gray-50': !showUnassignedOnly\n                  }\">\n                   <div class=\"w-2 h-2 rounded-full\" [ngClass]=\"unassignedCount > 0 ? 'bg-orange-500' : 'bg-gray-300'\"></div>\n                   Học sinh chưa có GV: <b>{{ unassignedCount }}</b> em\n                </button>\n\n                <div class=\"h-4 w-px bg-gray-300\"></div>\n\n                <p class=\"text-xs text-gray-500\">Đã chọn: <span class=\"font-bold text-blue-600\">{{ selectedStudentIds.size }}</span> em</p>\n             </div>\n          </div>\n          \n          <div class=\"flex gap-3\">\n             <!-- Block Filter (Khối) -->\n             <div class=\"relative w-40\">\n                <select \n                  (change)=\"onBlockFilterChange($event)\"\n                  class=\"w-full pl-2 pr-8 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none appearance-none bg-white\">\n                  <option value=\"\">Tất cả khối</option>\n                  <optgroup label=\"Mẫu Giáo\">\n                    <option value=\"Mầm\">Khối Mầm</option>\n                    <option value=\"Chồi\">Khối Chồi</option>\n                    <option value=\"Lá\">Khối Lá</option>\n                  </optgroup>\n                  <optgroup label=\"Nhà Trẻ\">\n                    <option value=\"6-18\">Khối 6-18 tháng</option>\n                    <option value=\"19-24\">Khối 19-24 tháng</option>\n                    <option value=\"25-36\">Khối 25-36 tháng</option>\n                  </optgroup>\n                </select>\n                <div class=\"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m6 9 6 6 6-6\"/></svg>\n                </div>\n             </div>\n\n             <!-- Class Filter (Lớp cụ thể) -->\n             <div class=\"relative w-40\">\n                <select \n                  (change)=\"onClassFilterChange($event)\"\n                  [ngValue]=\"classFilter\"\n                  class=\"w-full pl-2 pr-8 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none appearance-none bg-white\">\n                  <option [ngValue]=\"\">Tất cả lớp</option>\n                  <optgroup *ngFor=\"let group of getGroupedClasses()\" [label]=\"group.label\">\n                    <option *ngFor=\"let cls of group.classes\" [ngValue]=\"cls\">{{ cls }}</option>\n                  </optgroup>\n                </select>\n                <div class=\"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m6 9 6 6 6-6\"/></svg>\n                </div>\n             </div>\n\n             <!-- Student Search -->\n             <div class=\"relative flex-1\">\n                <input \n                  type=\"text\" \n                  (input)=\"onStudentSearch($event)\"\n                  placeholder=\"Tìm tên hoặc mã số...\" \n                  class=\"pl-9 pr-4 py-1.5 w-full border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none\"\n                >\n                <div class=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\">\n                   <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"11\" cy=\"11\" r=\"8\"/><path d=\"m21 21-4.3-4.3\"/></svg>\n                </div>\n             </div>\n          </div>\n        </div>\n\n        <!-- Table -->\n        <div class=\"flex-1 overflow-auto\">\n          <table class=\"w-full text-left border-collapse\">\n            <thead class=\"bg-white sticky top-0 z-10 shadow-sm text-xs font-semibold text-gray-500 uppercase\">\n              <tr>\n                <th class=\"px-4 py-3 border-b w-10 bg-gray-50\">\n                   <input type=\"checkbox\" [checked]=\"isAllSelected()\" (change)=\"toggleSelectAll()\" class=\"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer\">\n                </th>\n                <th class=\"px-4 py-3 border-b bg-gray-50\">Học sinh</th>\n                <th class=\"px-4 py-3 border-b bg-gray-50\">Lớp</th>\n                <th class=\"px-4 py-3 border-b bg-gray-50\">Giáo viên đang dạy</th>\n              </tr>\n            </thead>\n            <tbody class=\"divide-y divide-gray-100\">\n              <tr *ngFor=\"let student of filteredStudents\" \n                  class=\"hover:bg-blue-50/40 transition-colors\"\n                  [ngClass]=\"{'bg-blue-50': selectedStudentIds.has(student.id)}\">\n                \n                <!-- Checkbox Column -->\n                <td class=\"px-4 py-3 cursor-pointer\" (click)=\"toggleStudent(student.id)\">\n                   <input type=\"checkbox\" [checked]=\"selectedStudentIds.has(student.id)\" (change)=\"toggleStudent(student.id)\" class=\"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer\">\n                </td>\n\n                <!-- Info Column -->\n                <td class=\"px-4 py-3 cursor-pointer\" (click)=\"toggleStudent(student.id)\">\n                  <div class=\"font-medium text-gray-800 text-sm\">{{ student.fullName }}</div>\n                  <div class=\"text-xs text-gray-500 font-mono\">{{ student.code }}</div>\n                </td>\n\n                <!-- Class Column -->\n                <td class=\"px-4 py-3 cursor-pointer text-sm text-gray-600\" (click)=\"toggleStudent(student.id)\">\n                   {{ student.className }}\n                </td>\n\n                <!-- Assigned Teachers Column (Click to View Details) -->\n                <td class=\"px-4 py-3\">\n                  <div class=\"grid grid-cols-3 gap-1.5 w-fit\" \n                       (click)=\"openTeacherDetails(student)\"\n                       [ngClass]=\"{'cursor-pointer hover:opacity-80': getAssignedTeachers(student).length > 0}\">\n                    <ng-container *ngIf=\"getAssignedTeachers(student).length > 0; else noTeacher\">\n                       <span *ngFor=\"let t of getAssignedTeachers(student)\" \n                          class=\"inline-flex items-center justify-center px-2 py-0.5 rounded text-xs font-medium truncate whitespace-nowrap\"\n                          [ngClass]=\"student.homeroomTeacherId === t.id ? 'bg-red-100 text-red-800 border border-red-200' : 'bg-blue-100 text-blue-800 border border-blue-200'\">\n                        <span>{{ t.shortName }}</span>\n                        <span *ngIf=\"student.homeroomTeacherId === t.id\" class=\"ml-1 text-[10px] font-bold bg-red-600 text-white px-1 rounded\">CN</span>\n                      </span>\n                    </ng-container>\n                    <ng-template #noTeacher>\n                      <span class=\"text-gray-400 select-none\">-</span>\n                    </ng-template>\n                  </div>\n                </td>\n              </tr>\n              <tr *ngIf=\"filteredStudents.length === 0\">\n                 <td colspan=\"4\" class=\"p-8 text-center text-gray-500 text-sm\">\n                    {{ showUnassignedOnly ? 'Tuyệt vời! Tất cả học sinh đều đã có giáo viên.' : 'Không tìm thấy học sinh phù hợp' }}\n                 </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <!-- RIGHT COLUMN: TEACHER PALETTE (Fixed Action Area) -->\n      <div class=\"w-full lg:w-80 bg-white rounded-lg shadow-sm border border-gray-200 flex flex-col\">\n        <div class=\"p-4 border-b border-gray-200 bg-blue-50 rounded-t-lg\">\n           <h3 class=\"font-semibold text-blue-900 flex items-center gap-2\">\n             <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/><path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/></svg>\n             Chọn Giáo Viên\n           </h3>\n           \n           <!-- Teacher Search -->\n           <div class=\"mt-3 relative\">\n             <input \n               type=\"text\" \n               (input)=\"onTeacherSearch($event)\"\n               placeholder=\"Tìm tên hoặc CCCD...\" \n               class=\"w-full pl-8 pr-3 py-1.5 border border-blue-200 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none bg-white\"\n             >\n             <div class=\"absolute left-2.5 top-1/2 -translate-y-1/2 text-blue-400\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"11\" cy=\"11\" r=\"8\"/><path d=\"m21 21-4.3-4.3\"/></svg>\n             </div>\n           </div>\n        </div>\n\n        <div class=\"flex-1 overflow-y-auto p-2\">\n           <div class=\"space-y-1\">\n             <label *ngFor=\"let teacher of filteredTeachers\" \n                    class=\"flex items-center p-3 rounded-lg border transition-all cursor-pointer select-none group\"\n                    [ngClass]=\"{\n                      'bg-blue-50 border-blue-300 shadow-sm': isTeacherSelected(teacher.id),\n                      'bg-white border-transparent hover:bg-gray-50': !isTeacherSelected(teacher.id)\n                    }\">\n                <input type=\"checkbox\" \n                       class=\"hidden\"\n                       [checked]=\"isTeacherSelected(teacher.id)\"\n                       (change)=\"toggleTeacherSelection(teacher.id)\">\n                \n                <div class=\"flex items-center justify-center w-5 h-5 rounded border mr-3 transition-colors shrink-0\"\n                     [ngClass]=\"{\n                       'bg-blue-600 border-blue-600 text-white': isTeacherSelected(teacher.id),\n                       'border-gray-300 bg-white': !isTeacherSelected(teacher.id)\n                     }\">\n                     <svg *ngIf=\"isTeacherSelected(teacher.id)\" xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg>\n                </div>\n\n                <div class=\"flex-1 min-w-0\">\n                   <div class=\"text-sm font-medium truncate\" [ngClass]=\"{'text-blue-900': isTeacherSelected(teacher.id), 'text-gray-700': !isTeacherSelected(teacher.id)}\">{{ teacher.shortName }}</div>\n                   <div class=\"text-xs text-gray-500 truncate\">{{ teacher.name }}</div>\n                   <div class=\"text-[10px] text-gray-400 font-mono mt-0.5\">ID: {{ teacher.cccd.slice(-4) }}</div>\n                </div>\n             </label>\n             <div *ngIf=\"filteredTeachers.length === 0\" class=\"text-center p-4 text-xs text-gray-500 italic\">\n               Không tìm thấy giáo viên\n             </div>\n           </div>\n        </div>\n\n        <!-- ACTIONS -->\n        <div class=\"p-4 border-t border-gray-200 bg-gray-50 rounded-b-lg space-y-3\">\n           <div class=\"flex items-center justify-between text-xs text-gray-600 mb-1\">\n             <span>Chọn: <b>{{ selectedTeacherIds.size }}</b> GV</span>\n             <span>Áp dụng: <b>{{ selectedStudentIds.size }}</b> HS</span>\n           </div>\n\n           <div class=\"flex items-center gap-3 text-sm\">\n             <label class=\"flex items-center gap-2 text-gray-700\">\n               <input type=\"checkbox\" class=\"w-4 h-4\" #homeroomCheckbox [checked]=\"assignAsHomeroom\" (change)=\"onHomeroomToggle($any($event.target).checked, homeroomCheckbox)\">\n               <span>Đặt làm Giáo viên chủ nhiệm</span>\n             </label>\n             <div class=\"text-xs text-red-600 font-medium\">Nếu bật thì giáo viên sẽ được phân công làm chủ nhiệm của lớp đang chọn</div>\n           </div>\n\n           <button (click)=\"applyAssignment()\" \n                   [disabled]=\"selectedStudentIds.size === 0 || selectedTeacherIds.size === 0\"\n                   class=\"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded shadow-sm transition-all text-sm\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M5 12h14\"/><path d=\"M12 5v14\"/></svg>\n              Thêm phân công\n           </button>\n\n           <button (click)=\"removeAssignment()\" \n                   [disabled]=\"selectedStudentIds.size === 0 || selectedTeacherIds.size === 0\"\n                   class=\"w-full flex items-center justify-center gap-2 bg-white border border-red-200 text-red-600 hover:bg-red-50 disabled:bg-gray-50 disabled:text-gray-300 disabled:border-gray-200 font-medium py-2.5 px-4 rounded transition-all text-sm\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 6h18\"/><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/></svg>\n              Gỡ phân công\n           </button>\n        </div>\n      </div>\n\n      <!-- TEACHER DETAILS MODAL (Overlay) -->\n      <div *ngIf=\"viewingStudentDetails\" class=\"absolute inset-0 z-50 flex items-center justify-center\">\n         <!-- Backdrop -->\n         <div class=\"absolute inset-0 bg-black/40 backdrop-blur-sm\" (click)=\"closeTeacherDetails()\"></div>\n         \n         <!-- Modal Content -->\n         <div class=\"relative bg-white rounded-xl shadow-2xl w-[90%] max-w-4xl max-h-[90%] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200\">\n            <!-- Modal Header -->\n            <div class=\"p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50\">\n               <div>\n                  <h3 class=\"font-bold text-gray-800 text-lg\">Giáo viên phụ trách</h3>\n                  <p class=\"text-sm text-gray-500\">Học sinh: <span class=\"font-semibold text-blue-600\">{{ viewingStudentDetails.fullName }}</span></p>\n               </div>\n               <button (click)=\"closeTeacherDetails()\" class=\"p-2 hover:bg-gray-200 rounded-full transition-colors\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"text-gray-500\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>\n               </button>\n            </div>\n\n            <!-- Modal Body (Grid of Cards) -->\n            <div class=\"p-6 overflow-y-auto bg-gray-50/50\">\n               <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  <div *ngFor=\"let teacher of viewingTeachers\" class=\"bg-white rounded-xl border border-gray-200 shadow-sm p-5 hover:shadow-md transition-shadow relative group\">\n                     <!-- Header (Avatar + Name) -->\n                     <div class=\"flex items-start gap-4 mb-4\">\n                        <img [src]=\"teacher.avatar\" alt=\"Avatar\" class=\"w-12 h-12 rounded-full border border-gray-100 bg-gray-50 object-cover\">\n                        <div>\n                           <h4 class=\"font-bold text-gray-800 text-base uppercase leading-tight\">{{ teacher.name }}</h4>\n                           <span class=\"inline-block mt-1 px-2 py-0.5 bg-green-50 text-green-700 text-[10px] font-bold uppercase rounded border border-green-100\">Đang dạy</span>\n                        </div>\n                     </div>\n                     \n                     <!-- Info List -->\n                     <div class=\"space-y-3 mb-5\">\n                        <div class=\"flex items-center gap-3 text-sm text-gray-600\">\n                           <span class=\"w-5 text-center text-gray-400\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"18\" height=\"18\" x=\"3\" y=\"4\" rx=\"2\" ry=\"2\"/><line x1=\"16\" x2=\"16\" y1=\"2\" y2=\"6\"/><line x1=\"8\" x2=\"8\" y1=\"2\" y2=\"6\"/><line x1=\"3\" x2=\"21\" y1=\"10\" y2=\"10\"/></svg></span>\n                           <span>{{ teacher.dob }}</span>\n                           <span class=\"bg-blue-50 text-blue-700 px-2 rounded-full text-xs font-medium\">{{ teacher.gender }}</span>\n                        </div>\n                         <div class=\"flex items-center gap-3 text-sm text-gray-600\">\n                           <span class=\"w-5 text-center text-gray-400\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"20\" height=\"14\" x=\"2\" y=\"5\" rx=\"2\"/><path d=\"M2 10h20\"/><path d=\"M7 15h.01\"/><path d=\"M17 15h.01\"/></svg></span>\n                           <span class=\"font-medium text-gray-800\">CCCD: {{ teacher.cccd }}</span>\n                        </div>\n                        <div class=\"flex items-center gap-3 text-sm text-gray-600\">\n                           <span class=\"w-5 text-center text-gray-400\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\"/></svg></span>\n                           <span>{{ teacher.phone }}</span>\n                        </div>\n                        <div class=\"flex items-start gap-3 text-sm text-gray-600\">\n                           <span class=\"w-5 text-center text-gray-400 mt-0.5\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z\"/><circle cx=\"12\" cy=\"10\" r=\"3\"/></svg></span>\n                           <span class=\"text-xs leading-relaxed line-clamp-2\" title=\"{{ teacher.address }}\">{{ teacher.address }}</span>\n                        </div>\n                     </div>\n\n                     <!-- Actions -->\n                     <div class=\"flex gap-2 mt-auto\">\n                        <button class=\"flex-1 flex items-center justify-center gap-2 border border-gray-300 rounded py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors\">\n                           <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\"/></svg>\n                           Gọi điện\n                        </button>\n                     </div>\n                  </div>\n               </div>\n            </div>\n         </div>\n      </div>\n\n    </div>\n  `\n}), __param(0, Inject(ElementRef))], TeacherAssignmentComponent);\nexport { TeacherAssignmentComponent };","map":{"version":3,"names":["Component","ElementRef","Inject","CommonModule","FormsModule","MOCK_STUDENTS","MOCK_TEACHERS","TeacherAssignmentComponent","constructor","elementRef","students","teachers","filteredStudents","filteredTeachers","selectedStudentIds","Set","selectedTeacherIds","studentSearchTerm","blockFilter","classFilter","teacherSearchTerm","showUnassignedOnly","assignAsHomeroom","viewingStudentDetails","viewingTeachers","showToast","toastMessage","toastType","applyStudentFilters","showNotification","message","type","setTimeout","unassignedCount","filter","s","assignedTeacherIds","length","toggleUnassignedFilter","onStudentSearch","event","target","value","toLowerCase","onBlockFilterChange","onClassFilterChange","includes","getAvailableClasses","allClasses","map","className","sort","c","startsWith","getGroupedClasses","filteredClasses","mauGiao","nhaTre","groups","push","label","classes","getClassPriority","result","matchesSearch","fullName","code","matchesBlock","matchesClass","isUnassigned","matchesUnassigned","a","b","priorityA","priorityB","localeCompare","onTeacherSearch","t","name","shortName","cccd","toggleStudent","id","has","delete","add","toggleSelectAll","isAllSelected","clear","forEach","size","toggleTeacherSelection","teacherId","isTeacherSelected","applyAssignment","teachersToAdd","Array","from","countSuccess","hasError","student","added","newId","homeroomTeacherId","teacher","find","homeroomTeacher","existingClass","getHomeroomClassForTeacher","teacherName","removeAssignment","teachersToRemove","changeCount","originalLength","existingId","undefined","getAssignedTeachers","onHomeroomToggle","checked","checkboxElement","openTeacherDetails","assigned","closeTeacherDetails","__decorate","selector","standalone","imports","template","__param"],"sources":["D:\\VN AI SOFTWARE\\Code\\phan-cong-giao-vien\\components\\TeacherAssignment.ts"],"sourcesContent":["\r\nimport { Component, ElementRef, Inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MOCK_STUDENTS, MOCK_TEACHERS } from '../constants';\r\nimport { Student, Teacher } from '../types';\r\n\r\n@Component({\r\n  selector: 'app-teacher-assignment',\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule],\r\n  template: `\r\n    <div class=\"flex flex-col lg:flex-row gap-6 h-[calc(100vh-140px)] relative\">\r\n      \r\n      <!-- TOAST NOTIFICATION -->\r\n      <div *ngIf=\"showToast\" \r\n           class=\"absolute top-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-4 py-3 rounded-lg shadow-lg border animate-in fade-in slide-in-from-top-4 duration-300\"\r\n           [ngClass]=\"{\r\n             'bg-green-50 border-green-200 text-green-800': toastType === 'success',\r\n             'bg-yellow-50 border-yellow-200 text-yellow-800': toastType === 'warning',\r\n             'bg-red-50 border-red-200 text-red-800': toastType === 'error'\r\n           }\">\r\n         <div [ngClass]=\"{\r\n             'text-green-500': toastType === 'success',\r\n             'text-yellow-500': toastType === 'warning',\r\n             'text-red-500': toastType === 'error'\r\n         }\">\r\n            <svg *ngIf=\"toastType === 'success'\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/><polyline points=\"22 4 12 14.01 9 11.01\"/></svg>\r\n            <svg *ngIf=\"toastType === 'warning'\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\"/><line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/><line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/></svg>\r\n            <svg *ngIf=\"toastType === 'error'\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"/><line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"/></svg>\r\n         </div>\r\n         <div class=\"text-sm font-medium\">{{ toastMessage }}</div>\r\n         <button (click)=\"showToast = false\" class=\"ml-2 hover:opacity-70\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>\r\n         </button>\r\n      </div>\r\n\r\n      <!-- LEFT COLUMN: STUDENT LIST (Main Work Area) -->\r\n      <div class=\"flex-1 bg-white rounded-lg shadow-sm border border-gray-200 flex flex-col overflow-hidden\">\r\n        \r\n        <!-- Header & Search -->\r\n        <div class=\"p-4 border-b border-gray-200 bg-gray-50 flex flex-col gap-3\">\r\n          <div class=\"flex items-center justify-between\">\r\n             <h3 class=\"font-semibold text-gray-800\">Danh sách học sinh</h3>\r\n             \r\n             <div class=\"flex items-center gap-3\">\r\n                <!-- Total Students Badge -->\r\n                <div class=\"flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/><path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/></svg>\r\n                    Tổng số HS: <b>{{ students.length }}</b> em\r\n                </div>\r\n\r\n                <div class=\"h-4 w-px bg-gray-300\"></div>\r\n\r\n                <!-- Unassigned Filter Toggle -->\r\n                <button \r\n                  (click)=\"toggleUnassignedFilter()\"\r\n                  class=\"flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium border transition-colors shadow-sm\"\r\n                  [ngClass]=\"{\r\n                    'bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100': showUnassignedOnly,\r\n                    'bg-white text-gray-600 border-gray-300 hover:bg-gray-50': !showUnassignedOnly\r\n                  }\">\r\n                   <div class=\"w-2 h-2 rounded-full\" [ngClass]=\"unassignedCount > 0 ? 'bg-orange-500' : 'bg-gray-300'\"></div>\r\n                   Học sinh chưa có GV: <b>{{ unassignedCount }}</b> em\r\n                </button>\r\n\r\n                <div class=\"h-4 w-px bg-gray-300\"></div>\r\n\r\n                <p class=\"text-xs text-gray-500\">Đã chọn: <span class=\"font-bold text-blue-600\">{{ selectedStudentIds.size }}</span> em</p>\r\n             </div>\r\n          </div>\r\n          \r\n          <div class=\"flex gap-3\">\r\n             <!-- Block Filter (Khối) -->\r\n             <div class=\"relative w-40\">\r\n                <select \r\n                  (change)=\"onBlockFilterChange($event)\"\r\n                  class=\"w-full pl-2 pr-8 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none appearance-none bg-white\">\r\n                  <option value=\"\">Tất cả khối</option>\r\n                  <optgroup label=\"Mẫu Giáo\">\r\n                    <option value=\"Mầm\">Khối Mầm</option>\r\n                    <option value=\"Chồi\">Khối Chồi</option>\r\n                    <option value=\"Lá\">Khối Lá</option>\r\n                  </optgroup>\r\n                  <optgroup label=\"Nhà Trẻ\">\r\n                    <option value=\"6-18\">Khối 6-18 tháng</option>\r\n                    <option value=\"19-24\">Khối 19-24 tháng</option>\r\n                    <option value=\"25-36\">Khối 25-36 tháng</option>\r\n                  </optgroup>\r\n                </select>\r\n                <div class=\"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400\">\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m6 9 6 6 6-6\"/></svg>\r\n                </div>\r\n             </div>\r\n\r\n             <!-- Class Filter (Lớp cụ thể) -->\r\n             <div class=\"relative w-40\">\r\n                <select \r\n                  (change)=\"onClassFilterChange($event)\"\r\n                  [ngValue]=\"classFilter\"\r\n                  class=\"w-full pl-2 pr-8 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none appearance-none bg-white\">\r\n                  <option [ngValue]=\"\">Tất cả lớp</option>\r\n                  <optgroup *ngFor=\"let group of getGroupedClasses()\" [label]=\"group.label\">\r\n                    <option *ngFor=\"let cls of group.classes\" [ngValue]=\"cls\">{{ cls }}</option>\r\n                  </optgroup>\r\n                </select>\r\n                <div class=\"absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400\">\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m6 9 6 6 6-6\"/></svg>\r\n                </div>\r\n             </div>\r\n\r\n             <!-- Student Search -->\r\n             <div class=\"relative flex-1\">\r\n                <input \r\n                  type=\"text\" \r\n                  (input)=\"onStudentSearch($event)\"\r\n                  placeholder=\"Tìm tên hoặc mã số...\" \r\n                  class=\"pl-9 pr-4 py-1.5 w-full border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none\"\r\n                >\r\n                <div class=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\">\r\n                   <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"11\" cy=\"11\" r=\"8\"/><path d=\"m21 21-4.3-4.3\"/></svg>\r\n                </div>\r\n             </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Table -->\r\n        <div class=\"flex-1 overflow-auto\">\r\n          <table class=\"w-full text-left border-collapse\">\r\n            <thead class=\"bg-white sticky top-0 z-10 shadow-sm text-xs font-semibold text-gray-500 uppercase\">\r\n              <tr>\r\n                <th class=\"px-4 py-3 border-b w-10 bg-gray-50\">\r\n                   <input type=\"checkbox\" [checked]=\"isAllSelected()\" (change)=\"toggleSelectAll()\" class=\"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer\">\r\n                </th>\r\n                <th class=\"px-4 py-3 border-b bg-gray-50\">Học sinh</th>\r\n                <th class=\"px-4 py-3 border-b bg-gray-50\">Lớp</th>\r\n                <th class=\"px-4 py-3 border-b bg-gray-50\">Giáo viên đang dạy</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody class=\"divide-y divide-gray-100\">\r\n              <tr *ngFor=\"let student of filteredStudents\" \r\n                  class=\"hover:bg-blue-50/40 transition-colors\"\r\n                  [ngClass]=\"{'bg-blue-50': selectedStudentIds.has(student.id)}\">\r\n                \r\n                <!-- Checkbox Column -->\r\n                <td class=\"px-4 py-3 cursor-pointer\" (click)=\"toggleStudent(student.id)\">\r\n                   <input type=\"checkbox\" [checked]=\"selectedStudentIds.has(student.id)\" (change)=\"toggleStudent(student.id)\" class=\"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer\">\r\n                </td>\r\n\r\n                <!-- Info Column -->\r\n                <td class=\"px-4 py-3 cursor-pointer\" (click)=\"toggleStudent(student.id)\">\r\n                  <div class=\"font-medium text-gray-800 text-sm\">{{ student.fullName }}</div>\r\n                  <div class=\"text-xs text-gray-500 font-mono\">{{ student.code }}</div>\r\n                </td>\r\n\r\n                <!-- Class Column -->\r\n                <td class=\"px-4 py-3 cursor-pointer text-sm text-gray-600\" (click)=\"toggleStudent(student.id)\">\r\n                   {{ student.className }}\r\n                </td>\r\n\r\n                <!-- Assigned Teachers Column (Click to View Details) -->\r\n                <td class=\"px-4 py-3\">\r\n                  <div class=\"grid grid-cols-3 gap-1.5 w-fit\" \r\n                       (click)=\"openTeacherDetails(student)\"\r\n                       [ngClass]=\"{'cursor-pointer hover:opacity-80': getAssignedTeachers(student).length > 0}\">\r\n                    <ng-container *ngIf=\"getAssignedTeachers(student).length > 0; else noTeacher\">\r\n                       <span *ngFor=\"let t of getAssignedTeachers(student)\" \r\n                          class=\"inline-flex items-center justify-center px-2 py-0.5 rounded text-xs font-medium truncate whitespace-nowrap\"\r\n                          [ngClass]=\"student.homeroomTeacherId === t.id ? 'bg-red-100 text-red-800 border border-red-200' : 'bg-blue-100 text-blue-800 border border-blue-200'\">\r\n                        <span>{{ t.shortName }}</span>\r\n                        <span *ngIf=\"student.homeroomTeacherId === t.id\" class=\"ml-1 text-[10px] font-bold bg-red-600 text-white px-1 rounded\">CN</span>\r\n                      </span>\r\n                    </ng-container>\r\n                    <ng-template #noTeacher>\r\n                      <span class=\"text-gray-400 select-none\">-</span>\r\n                    </ng-template>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n              <tr *ngIf=\"filteredStudents.length === 0\">\r\n                 <td colspan=\"4\" class=\"p-8 text-center text-gray-500 text-sm\">\r\n                    {{ showUnassignedOnly ? 'Tuyệt vời! Tất cả học sinh đều đã có giáo viên.' : 'Không tìm thấy học sinh phù hợp' }}\r\n                 </td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- RIGHT COLUMN: TEACHER PALETTE (Fixed Action Area) -->\r\n      <div class=\"w-full lg:w-80 bg-white rounded-lg shadow-sm border border-gray-200 flex flex-col\">\r\n        <div class=\"p-4 border-b border-gray-200 bg-blue-50 rounded-t-lg\">\r\n           <h3 class=\"font-semibold text-blue-900 flex items-center gap-2\">\r\n             <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/><path d=\"M16 3.13a4 4 0 0 1 0 7.75\"/></svg>\r\n             Chọn Giáo Viên\r\n           </h3>\r\n           \r\n           <!-- Teacher Search -->\r\n           <div class=\"mt-3 relative\">\r\n             <input \r\n               type=\"text\" \r\n               (input)=\"onTeacherSearch($event)\"\r\n               placeholder=\"Tìm tên hoặc CCCD...\" \r\n               class=\"w-full pl-8 pr-3 py-1.5 border border-blue-200 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none bg-white\"\r\n             >\r\n             <div class=\"absolute left-2.5 top-1/2 -translate-y-1/2 text-blue-400\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"11\" cy=\"11\" r=\"8\"/><path d=\"m21 21-4.3-4.3\"/></svg>\r\n             </div>\r\n           </div>\r\n        </div>\r\n\r\n        <div class=\"flex-1 overflow-y-auto p-2\">\r\n           <div class=\"space-y-1\">\r\n             <label *ngFor=\"let teacher of filteredTeachers\" \r\n                    class=\"flex items-center p-3 rounded-lg border transition-all cursor-pointer select-none group\"\r\n                    [ngClass]=\"{\r\n                      'bg-blue-50 border-blue-300 shadow-sm': isTeacherSelected(teacher.id),\r\n                      'bg-white border-transparent hover:bg-gray-50': !isTeacherSelected(teacher.id)\r\n                    }\">\r\n                <input type=\"checkbox\" \r\n                       class=\"hidden\"\r\n                       [checked]=\"isTeacherSelected(teacher.id)\"\r\n                       (change)=\"toggleTeacherSelection(teacher.id)\">\r\n                \r\n                <div class=\"flex items-center justify-center w-5 h-5 rounded border mr-3 transition-colors shrink-0\"\r\n                     [ngClass]=\"{\r\n                       'bg-blue-600 border-blue-600 text-white': isTeacherSelected(teacher.id),\r\n                       'border-gray-300 bg-white': !isTeacherSelected(teacher.id)\r\n                     }\">\r\n                     <svg *ngIf=\"isTeacherSelected(teacher.id)\" xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg>\r\n                </div>\r\n\r\n                <div class=\"flex-1 min-w-0\">\r\n                   <div class=\"text-sm font-medium truncate\" [ngClass]=\"{'text-blue-900': isTeacherSelected(teacher.id), 'text-gray-700': !isTeacherSelected(teacher.id)}\">{{ teacher.shortName }}</div>\r\n                   <div class=\"text-xs text-gray-500 truncate\">{{ teacher.name }}</div>\r\n                   <div class=\"text-[10px] text-gray-400 font-mono mt-0.5\">ID: {{ teacher.cccd.slice(-4) }}</div>\r\n                </div>\r\n             </label>\r\n             <div *ngIf=\"filteredTeachers.length === 0\" class=\"text-center p-4 text-xs text-gray-500 italic\">\r\n               Không tìm thấy giáo viên\r\n             </div>\r\n           </div>\r\n        </div>\r\n\r\n        <!-- ACTIONS -->\r\n        <div class=\"p-4 border-t border-gray-200 bg-gray-50 rounded-b-lg space-y-3\">\r\n           <div class=\"flex items-center justify-between text-xs text-gray-600 mb-1\">\r\n             <span>Chọn: <b>{{ selectedTeacherIds.size }}</b> GV</span>\r\n             <span>Áp dụng: <b>{{ selectedStudentIds.size }}</b> HS</span>\r\n           </div>\r\n\r\n           <div class=\"flex items-center gap-3 text-sm\">\r\n             <label class=\"flex items-center gap-2 text-gray-700\">\r\n               <input type=\"checkbox\" class=\"w-4 h-4\" #homeroomCheckbox [checked]=\"assignAsHomeroom\" (change)=\"onHomeroomToggle($any($event.target).checked, homeroomCheckbox)\">\r\n               <span>Đặt làm Giáo viên chủ nhiệm</span>\r\n             </label>\r\n             <div class=\"text-xs text-red-600 font-medium\">Nếu bật thì giáo viên sẽ được phân công làm chủ nhiệm của lớp đang chọn</div>\r\n           </div>\r\n\r\n           <button (click)=\"applyAssignment()\" \r\n                   [disabled]=\"selectedStudentIds.size === 0 || selectedTeacherIds.size === 0\"\r\n                   class=\"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium py-2.5 px-4 rounded shadow-sm transition-all text-sm\">\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M5 12h14\"/><path d=\"M12 5v14\"/></svg>\r\n              Thêm phân công\r\n           </button>\r\n\r\n           <button (click)=\"removeAssignment()\" \r\n                   [disabled]=\"selectedStudentIds.size === 0 || selectedTeacherIds.size === 0\"\r\n                   class=\"w-full flex items-center justify-center gap-2 bg-white border border-red-200 text-red-600 hover:bg-red-50 disabled:bg-gray-50 disabled:text-gray-300 disabled:border-gray-200 font-medium py-2.5 px-4 rounded transition-all text-sm\">\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 6h18\"/><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"/><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"/></svg>\r\n              Gỡ phân công\r\n           </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- TEACHER DETAILS MODAL (Overlay) -->\r\n      <div *ngIf=\"viewingStudentDetails\" class=\"absolute inset-0 z-50 flex items-center justify-center\">\r\n         <!-- Backdrop -->\r\n         <div class=\"absolute inset-0 bg-black/40 backdrop-blur-sm\" (click)=\"closeTeacherDetails()\"></div>\r\n         \r\n         <!-- Modal Content -->\r\n         <div class=\"relative bg-white rounded-xl shadow-2xl w-[90%] max-w-4xl max-h-[90%] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200\">\r\n            <!-- Modal Header -->\r\n            <div class=\"p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50\">\r\n               <div>\r\n                  <h3 class=\"font-bold text-gray-800 text-lg\">Giáo viên phụ trách</h3>\r\n                  <p class=\"text-sm text-gray-500\">Học sinh: <span class=\"font-semibold text-blue-600\">{{ viewingStudentDetails.fullName }}</span></p>\r\n               </div>\r\n               <button (click)=\"closeTeacherDetails()\" class=\"p-2 hover:bg-gray-200 rounded-full transition-colors\">\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"text-gray-500\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>\r\n               </button>\r\n            </div>\r\n\r\n            <!-- Modal Body (Grid of Cards) -->\r\n            <div class=\"p-6 overflow-y-auto bg-gray-50/50\">\r\n               <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                  <div *ngFor=\"let teacher of viewingTeachers\" class=\"bg-white rounded-xl border border-gray-200 shadow-sm p-5 hover:shadow-md transition-shadow relative group\">\r\n                     <!-- Header (Avatar + Name) -->\r\n                     <div class=\"flex items-start gap-4 mb-4\">\r\n                        <img [src]=\"teacher.avatar\" alt=\"Avatar\" class=\"w-12 h-12 rounded-full border border-gray-100 bg-gray-50 object-cover\">\r\n                        <div>\r\n                           <h4 class=\"font-bold text-gray-800 text-base uppercase leading-tight\">{{ teacher.name }}</h4>\r\n                           <span class=\"inline-block mt-1 px-2 py-0.5 bg-green-50 text-green-700 text-[10px] font-bold uppercase rounded border border-green-100\">Đang dạy</span>\r\n                        </div>\r\n                     </div>\r\n                     \r\n                     <!-- Info List -->\r\n                     <div class=\"space-y-3 mb-5\">\r\n                        <div class=\"flex items-center gap-3 text-sm text-gray-600\">\r\n                           <span class=\"w-5 text-center text-gray-400\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"18\" height=\"18\" x=\"3\" y=\"4\" rx=\"2\" ry=\"2\"/><line x1=\"16\" x2=\"16\" y1=\"2\" y2=\"6\"/><line x1=\"8\" x2=\"8\" y1=\"2\" y2=\"6\"/><line x1=\"3\" x2=\"21\" y1=\"10\" y2=\"10\"/></svg></span>\r\n                           <span>{{ teacher.dob }}</span>\r\n                           <span class=\"bg-blue-50 text-blue-700 px-2 rounded-full text-xs font-medium\">{{ teacher.gender }}</span>\r\n                        </div>\r\n                         <div class=\"flex items-center gap-3 text-sm text-gray-600\">\r\n                           <span class=\"w-5 text-center text-gray-400\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect width=\"20\" height=\"14\" x=\"2\" y=\"5\" rx=\"2\"/><path d=\"M2 10h20\"/><path d=\"M7 15h.01\"/><path d=\"M17 15h.01\"/></svg></span>\r\n                           <span class=\"font-medium text-gray-800\">CCCD: {{ teacher.cccd }}</span>\r\n                        </div>\r\n                        <div class=\"flex items-center gap-3 text-sm text-gray-600\">\r\n                           <span class=\"w-5 text-center text-gray-400\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\"/></svg></span>\r\n                           <span>{{ teacher.phone }}</span>\r\n                        </div>\r\n                        <div class=\"flex items-start gap-3 text-sm text-gray-600\">\r\n                           <span class=\"w-5 text-center text-gray-400 mt-0.5\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z\"/><circle cx=\"12\" cy=\"10\" r=\"3\"/></svg></span>\r\n                           <span class=\"text-xs leading-relaxed line-clamp-2\" title=\"{{ teacher.address }}\">{{ teacher.address }}</span>\r\n                        </div>\r\n                     </div>\r\n\r\n                     <!-- Actions -->\r\n                     <div class=\"flex gap-2 mt-auto\">\r\n                        <button class=\"flex-1 flex items-center justify-center gap-2 border border-gray-300 rounded py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors\">\r\n                           <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z\"/></svg>\r\n                           Gọi điện\r\n                        </button>\r\n                     </div>\r\n                  </div>\r\n               </div>\r\n            </div>\r\n         </div>\r\n      </div>\r\n\r\n    </div>\r\n  `\r\n})\r\nexport class TeacherAssignmentComponent {\r\n  // Use MOCK_STUDENTS direct reference to ensure synchronization across modules\r\n  students: Student[] = MOCK_STUDENTS;\r\n  teachers: Teacher[] = MOCK_TEACHERS;\r\n  \r\n  filteredStudents: Student[] = [];\r\n  filteredTeachers: Teacher[] = [];\r\n  // ... rest of the code remains same, logic for references is updated by removing JSON.parse/stringify ...\r\n\r\n  selectedStudentIds: Set<number> = new Set();\r\n  selectedTeacherIds: Set<number> = new Set();\r\n\r\n  // Filter States\r\n  studentSearchTerm: string = '';\r\n  blockFilter: string = ''; // Khối: 'Mầm' | 'Chồi' | 'Lá' | '6-18' | '19-24' | '25-36' | ''\r\n  classFilter: string = ''; // Lớp cụ thể: 'Mầm 1', 'Mầm 2', 'Chồi 1', ...\r\n  teacherSearchTerm: string = '';\r\n  \r\n  // New state for unassigned filter\r\n  showUnassignedOnly: boolean = false;\r\n\r\n  // If true, applied teacher(s) will set homeroom for selected students\r\n  assignAsHomeroom: boolean = false;\r\n\r\n  // Modal State\r\n  viewingStudentDetails: Student | null = null;\r\n  viewingTeachers: Teacher[] = [];\r\n\r\n  // Toast Notification State\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n  toastType: 'success' | 'warning' | 'error' = 'success';\r\n  \r\n  constructor(@Inject(ElementRef) private elementRef: ElementRef) {\r\n    this.applyStudentFilters();\r\n    this.filteredTeachers = [...this.teachers];\r\n  }\r\n\r\n  // Helper to show notification\r\n  showNotification(message: string, type: 'success' | 'warning' | 'error' = 'success') {\r\n    this.toastMessage = message;\r\n    this.toastType = type;\r\n    this.showToast = true;\r\n    setTimeout(() => {\r\n        this.showToast = false;\r\n    }, 3000);\r\n  }\r\n\r\n  // Helper to count total unassigned students\r\n  get unassignedCount(): number {\r\n    return this.students.filter(s => !s.assignedTeacherIds || s.assignedTeacherIds.length === 0).length;\r\n  }\r\n\r\n  toggleUnassignedFilter() {\r\n    this.showUnassignedOnly = !this.showUnassignedOnly;\r\n    this.applyStudentFilters();\r\n  }\r\n\r\n  // --- Student Filters ---\r\n  onStudentSearch(event: any) {\r\n    this.studentSearchTerm = event.target.value.toLowerCase();\r\n    this.applyStudentFilters();\r\n  }\r\n\r\n  onBlockFilterChange(event: any) {\r\n    this.blockFilter = event.target.value;\r\n    this.classFilter = ''; // Reset class filter when block changes\r\n    this.applyStudentFilters();\r\n  }\r\n\r\n  onClassFilterChange(event: any) {\r\n    this.classFilter = event.target.value;\r\n    \r\n    // Auto-update blockFilter based on selected class\r\n    if (this.classFilter) {\r\n      if (this.classFilter.includes('Mầm')) {\r\n        this.blockFilter = 'Mầm';\r\n      } else if (this.classFilter.includes('Chồi')) {\r\n        this.blockFilter = 'Chồi';\r\n      } else if (this.classFilter.includes('Lá')) {\r\n        this.blockFilter = 'Lá';\r\n      } else if (this.classFilter.includes('6-18')) {\r\n        this.blockFilter = '6-18';\r\n      } else if (this.classFilter.includes('19-24')) {\r\n        this.blockFilter = '19-24';\r\n      } else if (this.classFilter.includes('25-36')) {\r\n        this.blockFilter = '25-36';\r\n      }\r\n    }\r\n    \r\n    this.applyStudentFilters();\r\n  }\r\n\r\n  // Get available classes based on current block filter\r\n  getAvailableClasses(): string[] {\r\n    const allClasses = [...new Set(this.students.map(s => s.className))].sort();\r\n    if (!this.blockFilter) return allClasses;\r\n    \r\n    // Filter by block prefix (e.g., 'Mầm' includes 'Mầm 1', 'Mầm 2')\r\n    return allClasses.filter(c => c.startsWith(this.blockFilter));\r\n  }\r\n\r\n  // Get grouped classes for template\r\n  getGroupedClasses(): { label: string; classes: string[] }[] {\r\n    const allClasses = [...new Set(this.students.map(s => s.className))].sort();\r\n    \r\n    // If blockFilter is set, only show classes in that block\r\n    let filteredClasses = allClasses;\r\n    if (this.blockFilter) {\r\n      filteredClasses = allClasses.filter(c => c.startsWith(this.blockFilter));\r\n    }\r\n    \r\n    const mauGiao = filteredClasses.filter(c => c.includes('Mầm') || c.includes('Chồi') || c.includes('Lá'));\r\n    const nhaTre = filteredClasses.filter(c => c.includes('6-18') || c.includes('19-24') || c.includes('25-36'));\r\n    \r\n    const groups: { label: string; classes: string[] }[] = [];\r\n    \r\n    if (mauGiao.length > 0) {\r\n      groups.push({ label: 'Mẫu Giáo', classes: mauGiao });\r\n    }\r\n    if (nhaTre.length > 0) {\r\n      groups.push({ label: 'Nhà Trẻ', classes: nhaTre });\r\n    }\r\n    \r\n    return groups;\r\n  }\r\n\r\n  getClassPriority(className: string): number {\r\n    if (className.includes('Mầm')) return 1;\r\n    if (className.includes('Chồi')) return 2;\r\n    if (className.includes('Lá')) return 3;\r\n    if (className.includes('6-18')) return 4;\r\n    if (className.includes('19-24')) return 5;\r\n    if (className.includes('25-36')) return 6;\r\n    return 99; // Các lớp khác (nếu có)\r\n  }\r\n\r\n  applyStudentFilters() {\r\n    // 1. Filter\r\n    let result = this.students.filter(s => {\r\n      const matchesSearch = s.fullName.toLowerCase().includes(this.studentSearchTerm) || \r\n                            s.code.toLowerCase().includes(this.studentSearchTerm);\r\n      \r\n      // Filter by block first (e.g., 'Mầm' matches 'Mầm 1', 'Mầm 2')\r\n      let matchesBlock = true;\r\n      if (this.blockFilter) {\r\n        matchesBlock = s.className.startsWith(this.blockFilter);\r\n      }\r\n      \r\n      // Then filter by specific class (exact match)\r\n      const matchesClass = this.classFilter ? s.className === this.classFilter : true;\r\n      \r\n      const isUnassigned = !s.assignedTeacherIds || s.assignedTeacherIds.length === 0;\r\n      const matchesUnassigned = this.showUnassignedOnly ? isUnassigned : true;\r\n\r\n      return matchesSearch && matchesBlock && matchesClass && matchesUnassigned;\r\n    });\r\n\r\n    // 2. Sort: Mầm -> Chồi -> Lá -> 6-18 -> 19-24 -> 25-36\r\n    result.sort((a, b) => {\r\n      const priorityA = this.getClassPriority(a.className);\r\n      const priorityB = this.getClassPriority(b.className);\r\n\r\n      if (priorityA !== priorityB) {\r\n        return priorityA - priorityB;\r\n      }\r\n      \r\n      return a.className.localeCompare(b.className);\r\n    });\r\n\r\n    this.filteredStudents = result;\r\n  }\r\n\r\n  // --- Teacher Search ---\r\n  onTeacherSearch(event: any) {\r\n    this.teacherSearchTerm = event.target.value.toLowerCase();\r\n    this.filteredTeachers = this.teachers.filter(t => \r\n      t.name.toLowerCase().includes(this.teacherSearchTerm) || \r\n      t.shortName.toLowerCase().includes(this.teacherSearchTerm) ||\r\n      t.cccd.includes(this.teacherSearchTerm)\r\n    );\r\n  }\r\n\r\n  // --- Student Selection Logic ---\r\n  toggleStudent(id: number) {\r\n    if (this.selectedStudentIds.has(id)) {\r\n      this.selectedStudentIds.delete(id);\r\n    } else {\r\n      this.selectedStudentIds.add(id);\r\n    }\r\n  }\r\n\r\n  toggleSelectAll() {\r\n    if (this.isAllSelected()) {\r\n      this.selectedStudentIds.clear();\r\n    } else {\r\n      this.filteredStudents.forEach(s => this.selectedStudentIds.add(s.id));\r\n    }\r\n  }\r\n\r\n  isAllSelected(): boolean {\r\n    return this.filteredStudents.length > 0 && this.selectedStudentIds.size === this.filteredStudents.length;\r\n  }\r\n\r\n  // --- Teacher Selection Logic ---\r\n  toggleTeacherSelection(teacherId: number) {\r\n    if (this.selectedTeacherIds.has(teacherId)) {\r\n      this.selectedTeacherIds.delete(teacherId);\r\n    } else {\r\n      this.selectedTeacherIds.add(teacherId);\r\n    }\r\n  }\r\n\r\n  isTeacherSelected(teacherId: number): boolean {\r\n    return this.selectedTeacherIds.has(teacherId);\r\n  }\r\n\r\n  // --- Main Actions ---\r\n  applyAssignment() {\r\n    if (this.selectedStudentIds.size === 0 || this.selectedTeacherIds.size === 0) return;\r\n\r\n    const teachersToAdd = Array.from(this.selectedTeacherIds);\r\n    // If assigning as homeroom, ensure only one teacher is selected\r\n    if (this.assignAsHomeroom && teachersToAdd.length > 1) {\r\n      this.showNotification('Chỉ có thể chọn 1 giáo viên làm chủ nhiệm. Vui lòng chọn 1 giáo viên.', 'warning');\r\n      // Uncheck the homeroom toggle immediately\r\n      this.assignAsHomeroom = false;\r\n      return;\r\n    }\r\n    let countSuccess = 0;\r\n    let hasError = false;\r\n\r\n    this.students.forEach(student => {\r\n      if (this.selectedStudentIds.has(student.id)) {\r\n        if (!student.assignedTeacherIds) student.assignedTeacherIds = [];\r\n        \r\n        let added = false;\r\n        for (const newId of teachersToAdd) {\r\n          // If not assigning as homeroom and the teacher is already the student's homeroom, warn and skip\r\n          if (!this.assignAsHomeroom && student.homeroomTeacherId && newId === student.homeroomTeacherId) {\r\n            const teacher = this.teachers.find(t => t.id === newId);\r\n            if (teacher) {\r\n              this.showNotification(`Giáo viên ${teacher.shortName} đã được phân làm giáo viên chủ nhiệm cho học sinh ${student.fullName}.`, 'warning');\r\n            }\r\n            continue;\r\n          }\r\n\r\n          if (!student.assignedTeacherIds!.includes(newId)) {\r\n            student.assignedTeacherIds!.push(newId);\r\n            added = true;\r\n          }\r\n        }\r\n\r\n        // If assigning as homeroom, set homeroomTeacherId to the first selected teacher\r\n        if (this.assignAsHomeroom && teachersToAdd.length > 0) {\r\n          const homeroomTeacherId = teachersToAdd[0];\r\n          const homeroomTeacher = this.teachers.find(t => t.id === homeroomTeacherId);\r\n          \r\n          // Check if this teacher is already homeroom of another class\r\n          const existingClass = this.getHomeroomClassForTeacher(homeroomTeacherId);\r\n          if (existingClass && existingClass !== student.className) {\r\n            const teacherName = homeroomTeacher?.shortName || 'Giáo viên';\r\n            this.showNotification(`${teacherName} đã là giáo viên chủ nhiệm của lớp ${existingClass}. Một giáo viên chỉ có thể chủ nhiệm 1 lớp.`, 'error');\r\n            hasError = true;\r\n            // Reset homeroom toggle when error occurs\r\n            this.assignAsHomeroom = false;\r\n            return; // Stop assignment for this student\r\n          }\r\n          \r\n          // pick first selected teacher as homeroom\r\n          student.homeroomTeacherId = homeroomTeacherId;\r\n          // ensure homeroom teacher is included in assignedTeacherIds\r\n          if (!student.assignedTeacherIds.includes(homeroomTeacherId)) {\r\n            student.assignedTeacherIds.push(homeroomTeacherId);\r\n            added = true;\r\n          }\r\n        }\r\n\r\n        if (added) countSuccess++;\r\n      }\r\n    });\r\n\r\n    this.applyStudentFilters(); // Refresh UI\r\n    this.selectedTeacherIds.clear(); // Reset Teacher checkboxes\r\n    this.selectedStudentIds.clear(); // Reset Student checkboxes\r\n    // Reset the homeroom assignment toggle after applying\r\n    this.assignAsHomeroom = false;\r\n\r\n    // Only show success message if there was no error and assignments were made\r\n    if (!hasError && countSuccess > 0) {\r\n      this.showNotification(`Đã phân công thành công cho ${countSuccess} học sinh!`, 'success');\r\n    }\r\n  }\r\n\r\n  removeAssignment() {\r\n     if (this.selectedStudentIds.size === 0 || this.selectedTeacherIds.size === 0) return;\r\n\r\n     const teachersToRemove = Array.from(this.selectedTeacherIds);\r\n     let changeCount = 0;\r\n\r\n     this.students.forEach(student => {\r\n       if (this.selectedStudentIds.has(student.id) && student.assignedTeacherIds) {\r\n          const originalLength = student.assignedTeacherIds.length;\r\n          student.assignedTeacherIds = student.assignedTeacherIds.filter(\r\n            existingId => !teachersToRemove.includes(existingId)\r\n          );\r\n          // If homeroom teacher removed, clear homeroomTeacherId\r\n          if (student.homeroomTeacherId && teachersToRemove.includes(student.homeroomTeacherId)) {\r\n            student.homeroomTeacherId = undefined;\r\n          }\r\n          if (student.assignedTeacherIds.length !== originalLength) {\r\n             changeCount++;\r\n          }\r\n       }\r\n     });\r\n\r\n    if (changeCount === 0) {\r\n       this.showNotification('Các học sinh đã chọn chưa được phân công bởi giáo viên này.', 'warning');\r\n       return;\r\n    }\r\n\r\n    this.applyStudentFilters(); // Refresh UI\r\n    this.selectedTeacherIds.clear(); // Reset Teacher checkboxes\r\n    this.selectedStudentIds.clear(); // Reset Student checkboxes\r\n\r\n    this.showNotification(`Đã gỡ phân công thành công cho ${changeCount} học sinh.`, 'success');\r\n  }\r\n\r\n  // --- Helpers ---\r\n  getAssignedTeachers(student: Student): Teacher[] {\r\n    if (!student.assignedTeacherIds) return [];\r\n    return this.teachers.filter(t => student.assignedTeacherIds!.includes(t.id));\r\n  }\r\n\r\n  // Check if a teacher is already homeroom of another class\r\n  getHomeroomClassForTeacher(teacherId: number): string | null {\r\n    const student = this.students.find(s => s.homeroomTeacherId === teacherId);\r\n    return student ? student.className : null;\r\n  }\r\n\r\n  // Toggle handler for homeroom checkbox — validate selection\r\n  onHomeroomToggle(checked: boolean, checkboxElement?: any) {\r\n    if (checked && this.selectedTeacherIds.size > 1) {\r\n      this.showNotification('Chỉ có thể chọn 1 giáo viên làm chủ nhiệm. Vui lòng chọn 1 giáo viên.', 'warning');\r\n      this.assignAsHomeroom = false;\r\n      // Force uncheck the checkbox immediately\r\n      if (checkboxElement) {\r\n        checkboxElement.checked = false;\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.assignAsHomeroom = checked;\r\n  }\r\n\r\n  // --- Details Modal Logic ---\r\n  openTeacherDetails(student: Student) {\r\n    const assigned = this.getAssignedTeachers(student);\r\n    if (assigned.length === 0) return;\r\n    \r\n    this.viewingStudentDetails = student;\r\n    this.viewingTeachers = assigned;\r\n  }\r\n\r\n  closeTeacherDetails() {\r\n    this.viewingStudentDetails = null;\r\n    this.viewingTeachers = [];\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}